---
title: "Gov 50 Final Project"
author: "Emma Rogers"
description: "Prices of Used Cars"
output:
  distill::distill_article:
    self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(infer)
```

## Introduction

What factors or characteristics most affect the selling price of used cars? I hypothesize that the distance traveled by a car will have the greatest effect on the selling price and as the distance traveled by a car increases, the cost of this car will decrease. Cars that have been driven more kilometers are worth less than those that have not. This is because the distance a car has traveled indicates how much work and repair the car might need and how much more life the next owner will get out of the car. To examine this relationship, I will be using data scraped from CarDeckho, Indiaâ€™s leading car search website. All variables are measured from the vehicle information included on used car sales listings on CarDeckho in the year 2020. My dependent variable is the selling price of cars, and the independent variables include kilometers driven (continuous), fuel type (binary: Petrol, Diesel) and car age/years since car was first purchased (continuous). The research design for this study is cross-sectional as it is examining the outcome and explanatory variables at one point in time.


```{r, echo = FALSE}
cars <- read_csv("CAR DETAILS FROM CAR DEKHO.csv")
cars <- cars |>
  filter(fuel %in% c("Diesel", "Petrol")) |>
  mutate(age = 2020 - year)
```


```{r, echo = FALSE}
## summarize dependent variable
cars |>
  ggplot(mapping = aes(x = selling_price)) +
  geom_histogram(color = "black", fill = "darkslategray1") +
  labs(x = "Price of Used Car (in dollars)",
       y = "Number of Cars Sold",
       title = "Selling Prices of Used Cars",
       tag = "Figure 1:") +
  geom_vline(aes(xintercept = mean(selling_price)), color = "indianred") +
  geom_vline(aes(xintercept = median(selling_price)), color = "blue1") +
  theme_classic() 
```
```{r, echo = FALSE}
## summarize price by fuel type
cars |>
  ggplot(mapping = aes(x = selling_price)) +
  geom_histogram(color = "black", fill = "darkslategray1") +
  labs(x = "Price of Used Car (in dollars)",
       y = "Number of Cars Sold",
       title = "Selling Prices of Used Cars",
       tag = "Figure 2:") +
  geom_vline(aes(xintercept = mean(selling_price)), color = "indianred") +
  geom_vline(aes(xintercept = median(selling_price)), color = "blue1") +
  theme_classic() +
  facet_wrap(~ fuel)
```


```{r, echo = FALSE, results= 'hide'}
library(broom)

## Regression: price and km_driven
fit_1 <- lm(selling_price ~ km_driven, data = cars)
fit_1
glance(fit_1)

## Correlation
cor_pr_dist <- cor(cars$selling_price, cars$km_driven)

## Scatterplot 1
cars |>
  ggplot(mapping = aes(x = km_driven, y = selling_price)) +
  geom_point(alpha = 0.5) +
  ylim(0, 10000000) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Distance Traveled by Car (in Kilometers)",
       y = "Price of Car",
       title = "Correlation: Distance Traveled By Car vs Selling Price",
       tag = "Figure 3:") +
  theme_bw()

```


```{r, echo = FALSE, results= 'hide'}
## Fit 1 w/out outliers
cars_edit <- cars |>
  filter(km_driven < 5e+05 & selling_price < 7500000)
edit_fit <-
  lm(selling_price ~ km_driven, data = cars_edit)
edit_fit

## scatterplot 1 w/out outliers
cars_edit |>
  ggplot(mapping = aes(x = km_driven, y = selling_price)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Distance Traveled by Car (in Kilometers)",
       y = "Price of Car",
       title = "Correlation: Distance Traveled vs Selling Price (w/out outliers)",
       tag = "Figure 4:") +
  theme_bw()
```
There is a negative correlation between distance traveled and the selling price at a value of -0.19.

```{r, echo = FALSE, results= 'hide'}
## Multiple Regression: km_driven + fuel
mult_fit1 <- lm(selling_price ~ km_driven + fuel, data = cars)
mult_fit1
glance(mult_fit1)
```

```{r, echo = FALSE, results= 'hide'}
## Mult Regression: km_driven + age
mult_fit2 <- lm(selling_price ~ km_driven + age, data = cars)
mult_fit2
```

```{r, echo = FALSE, results= 'hide'}
## Multiple Regression: km_driven + fuel + age
mult_fit4 <- lm(selling_price ~ km_driven + fuel + age, data = cars)
mult_fit4
glance(mult_fit4)
```

```{r, echo = FALSE, results= 'hide'}
## Regression w/ age
fit_age <- lm(selling_price ~ age, data = cars)
fit_age
glance(fit_age)

cor_pr_age <- cor(cars$selling_price, cars$age)

```

```{r, echo = FALSE, results = 'hide'}
mult_fit3 <- lm(selling_price ~ fuel + age, data = cars)
mult_fit3
```


```{r, echo = FALSE, results= 'hide'}
## Scatterplot for age and price
cars |>
  ggplot(mapping = aes(x = age, y = selling_price)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Years since car was purchased",
       y = "Price of Car",
       title = "Correlation: Car Age vs Selling Price",
       tag = "Figure 5:") +
  theme_bw()
```
There is a negative correlation between age and selling price at a value of -0.41.

```{r, echo= FALSE, results = 'hide'}
## correlation between age and dist
cor_dist_age <- cor(cars$km_driven, cars$age)

## scatterplot between age and dist
cars |>
  ggplot(mapping = aes(x = km_driven, y = age)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Distance Traveled by Car (in Km)",
       y = "Years since car was purchased",
       title = "Correlation: Distance Traveled By Car vs Car Age",
       tag = "Figure 6:") +
  theme_bw()
```
There is a positive correlation of 0.42 between two of our independent variables: age and km_driven.

```{r, echo = FALSE}
## Regressions Table
var_labels <- c(
  "(Intercept)" = "Intercept",
  "km_driven" = "Km Driven",
  "fuelPetrol" = "Petrol Fuel vs Diesel",
  "age" = "Age"
)

modelsummary::modelsummary(
  statistic = c("s.e. = {std.error}",
               "p = {p.value}"),
  list(
    "Model 1" = fit_1,
    "Model 2" = mult_fit1, 
    "Model 3" = mult_fit2, 
    "Model 4" = mult_fit3, 
    "Final Model" = mult_fit4),
  coef_map = var_labels,
  title = "Regression Table",
  gof_map = c("nobs", "r.squared", "adj.r.squared"))
```

## Results

```{r, echo = FALSE}
cars |>
  ggplot(mapping = aes(x = age, y = selling_price)) +
  geom_point(mapping = aes(color = km_driven), alpha = 0.5) +
  scale_color_distiller(palette = "Spectral") +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Years since car was purchased",
       y = "Price of Car",
       title = "Main regression",
       tag = "Figure 7:") +
  theme_bw() +
  facet_wrap(~ fuel)
```

```{r, echo = FALSE}
## Main Regression of interest
modelsummary::modelsummary(
  statistic = c("s.e. = {std.error}",
               "p = {p.value}"),
  list(
    "Final Model" = mult_fit4),
  title = "Main Regression of Interest",
  coef_map = var_labels,
  gof_map = c("nobs", "r.squared", "adj.r.squared"))
```


Although the kilometers driven by a car does have a negative correlation with the selling price, age of the car has the greatest effect on the outcome variable. While keeping km driven and fuel constant, a 1 year increase in age is associated with a $44,521.46 decrease in the selling price of a car. With a test level of 0.05, the estimated coefficient of age is statistically significant as the p-value is approximately zero. Though there is a significant correlation of 0.42 between age and the price of a used car, this relationship cannot be interpreted causally. This is due to the multiple possible confounders that are not measured in this dataset that could be affecting the selling price of a car. Possible confounders include the exterior condition of the car, special features and technology, and number of seats. Without accounting for these other variables and their impacts on the outcome variable, we can not conclude that the coefficient of car age represents a causal effect.

## Conclusion

Through analyzing this data, we found that distance traveled by a car does have a negative correlation with its selling price. However, after running regressions accounting for multiple independent variables, the distance traveled had a lesser effect on selling price than I had expected.

First, figure 3 displays the relationship between the independent variable km_driven and the outcome variable selling price. Figure 4 is a replication of figure 3 with some extreme outliers filtered out. This scatterplot displays a negative correlation of -0.19 between distance traveled and selling price indicating that a 1 Km increase in distance traveled is associated with a decrease in selling price of $2.37. After exploring this initial relationship, I completed a number of regressions with different combinations of variables to compare the effects each variable had on the outcome. When accounting for fuel and age in addition to km_driven in the Final Model, the magnitude of effect that km_driven had on the selling price decreased significantly while the R2 value increased significantly. This displayed that age and fuel were important to include as they had strong effects on the outcome. This brought me to explore the age variable more closely, since in model 3, which included age and km_driven as independent variables, the effect of km_driven decreased to -0.259 from -2.372 (its effect on the outcome without accounting for other variables). Figure 5 shows the relationship between car age and selling price which is a negative correlation of -0.41 demonstrating a much stronger association than that of km_driven and price. A threat to inference is the correlation between km_driven and age. In figure 6, there is a strong positive correlation between km_driven and age of 0.42. This makes logical sense because the longer an owner has a car, the more likely they are to have driven more kilometers. This might be impacting our interpretation of the effects of each individual variable because we cannot be sure that our coefficient represents a case when the other independent variable is constant; if one variable is correlated with another, then a change in one variable could result in a change in the other. It would be ideal if all independent variables were truly independent from one another, however, since both variables have an effect on the outcome it is important to account for both. In future studies, it would be better to utilize variables that have no correlation with one another to capture a fairer estimate of each variableâ€™s effects. 

